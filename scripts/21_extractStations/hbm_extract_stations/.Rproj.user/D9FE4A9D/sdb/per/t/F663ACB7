{
    "collab_server" : "",
    "contents" : "createL1file = function(stations, varnames, varmapping, dataL1, outdir, grids, suffix = '') {\n  \n  ncIdOut = list()\n  \n  copyAtts = c('cell_methods', 'positive', 'negative', 'standard_name')\n  \n  for (iStat in names(stations)) {\n    # print(iStat)\n    iG = stations[[iStat]]$grid\n    \n    all_dims = list()\n    all_vars = list()\n    \n    for (iD in c('lon', 'lat')) {\n      all_dims[[iD]] = ncdim_def(iD, grids[[iG]][[iD]]$units, \n                                 vals = stations[[iStat]][[iD]], \n                                 unlim = grids[[iG]][[iD]]$unlim,\n                                 longname = grids[[iG]][[iD]]$long_name)\n    }\n    \n    for (iD in c('z', 'sur', 'sed', 'time')) {\n      all_dims[[iD]] = ncdim_def(iD, grids[[iG]][[iD]]$units, \n                                 vals = grids[[iG]][[iD]]$values, \n                                 unlim = grids[[iG]][[iD]]$unlim,\n                                 longname = grids[[iG]][[iD]]$long_name)\n    }\n    \n    for (iV in varnames$L1) {\n      # print(iV)\n      if (varmapping$L0Di[[varmapping$L1L0[[iV]]]] == 4) {\n        tmp_dims = list(all_dims$lon, all_dims$lat, all_dims$z, all_dims$time)\n      } else if (varmapping$L0Di[[varmapping$L1L0[[iV]]]] == 3) {\n        if (varmapping$L0Fi[[varmapping$L1L0[[iV]]]] == 'bendat') {\n          tmp_dims = list(all_dims$lon, all_dims$lat, all_dims$sed, all_dims$time)\n        } else {\n          tmp_dims = list(all_dims$lon, all_dims$lat, all_dims$sur, all_dims$time)\n        }\n      } else {\n        stop(paste0('Bad dimensions of variable ', iV))\n      }\n      \n      tmpAtts = dataL1[[iV]]$attributes\n      all_vars[[iV]] = ncvar_def(iV, units = tmpAtts$units,\n                                    dim = tmp_dims,\n                                    longname = iV, # tmpAtts$long_name,\n                                    prec = 'float')\n    }\n    # time independent depth (averaged)\n    all_vars[['depth2']] = ncvar_def('depth2', units = 'm',\n                                     dim = list(all_dims$lon, all_dims$lat, all_dims$z), \n                                     longname = 'depth2',\n                                     prec = 'float')\n    \n    \n    # print(paste(outdir, paste(paste0(paste(iStat, 'L1', sep = '_'), suffix), 'nc', sep = '.'), sep = '/'))\n    ncIdTmp = nc_create(paste(outdir, paste(paste0(paste(iStat, 'L1', sep = '_'), suffix), 'nc', sep = '.'), sep = '/'), vars = all_vars, verbose=FALSE)\n    \n    #' global attributes\n    ncatt_put(ncIdTmp, 0, 'contact', \"Daniel Neumann\", prec = 'text')\n    ncatt_put(ncIdTmp, 0, 'contact_email', \"daniel.neumann@io-warnemuende.de\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'originator', \"Daniel Neumann\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'contributor_name', \"Hagen Radtke, Thomas Neumann, Fabian Schwichtenberg, Ina Lorkowski\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'institution', \"Leibniz Institute for Baltic Sea Research Warnemuende, Rostock, Germany\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'source', \"model: HBM-ERGOM; grid/domain: fine+coarse; boundary conditions: TODO; initial condition: TODO; hardware: HLRN SMP1 Hannover; compiler set: Intel vTODO; meteo: TODO\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'summary', \"TODO\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'standard_name_vocabulary', \"CF Standard Names 1.6\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'title', \"TODO\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'creationTime', \"2017-05-02T12:00:00Z\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'date_created', \"2017-05-02\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'date_modified', \"2017-05-29\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'crs', \"TODO\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'Conventions', \"CF-1.6\", prec = 'character')\n    ncatt_put(ncIdTmp, 0, 'history', \"\", prec = 'character')\n    \n    \n    for (iV in varnames$L1) {\n      for (iAtt in intersect(copyAtts,names(dataL1[[iV]]$attributes))) {\n        ncatt_put(ncIdTmp, iV, iAtt, dataL1[[iV]]$attributes[[iAtt]], prec = 'character')\n      }\n      ncatt_put(ncIdTmp, iV, 'coordinates', 'lon lat', prec = 'character')\n      ncvar_put(ncIdTmp, iV, dataL1[[iV]]$data[[iStat]][1,1,,1:all_dims$time$len])\n    }\n    \n    # time independent depth (averaged)\n    ncatt_put(ncIdTmp, 'depth2', 'coordinates', 'lon lat', prec = 'character')\n    ncvar_put(ncIdTmp, 'depth2', rowMeans(dataL1[['depth']]$data[[iStat]], dim = 3))\n    \n    nc_sync(ncIdTmp)\n    \n    ncIdOut[[iStat]] = ncIdTmp\n    \n    nc_close(ncIdTmp)\n  }\n  \n  return(ncIdOut)\n}",
    "created" : 1496782471374.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2903747966",
    "id" : "F663ACB7",
    "lastKnownWriteTime" : 1497002797,
    "last_content_update" : 1497002797012,
    "path" : "/media/neumannd/work_dell/88_MeRamo/64_validator_data_preparation/workflow/hbm_extract_stations/support/createL1file.R",
    "project_path" : "support/createL1file.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}